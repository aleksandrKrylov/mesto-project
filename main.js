(()=>{"use strict";var e=document.querySelector(".profile__button-edit"),t=document.querySelector(".form_type_profile"),n=document.querySelector(".popup_type_profile"),r=document.querySelector(".profile__name"),o=document.querySelector(".profile__activity"),c=document.querySelector(".form__input_type_name"),u=document.querySelector(".form__input_type_activity"),a=document.querySelector(".form__button_profile"),i=document.querySelector(".profile__button-add"),l=document.querySelector(".form_type_card"),d=document.querySelector(".popup_type_card"),s=document.querySelector(".form__input_type_title"),f=document.querySelector(".form__input_type_link"),_=document.querySelector(".form__button_card-add"),m=document.querySelector(".profile__avatar-overlay"),y=document.querySelector(".popup_type_avatar"),p=document.querySelector(".profile__img"),v=document.querySelector(".form__input_type_link-avatar"),h=document.querySelector(".form_type_avatar"),b=document.querySelector(".form__button_avatar"),S=document.querySelectorAll(".popup"),g=document.querySelector(".cards"),q=document.querySelector(".enlarged-view__img"),k=document.querySelector(".enlarged-view__title"),L=document.querySelector(".popup_type_img"),E={formSelector:".form",inputSelector:".form__input",inputInvalidClass:"form__input_validation",buttonSelector:".form__button",buttonDisabledClass:"form__button_validation"};function C(e){e.classList.add("popup_opened"),document.addEventListener("keydown",A)}function x(e){e.classList.remove("popup_opened"),document.removeEventListener("keydown",A)}function A(e){"Escape"===e.key&&x(document.querySelector(".popup_opened"))}var O,w,U,j={baseUrl:"https://nomoreparties.co/v1/plus-cohort-6",headers:{Authorization:"79024d29-85c4-4423-a758-043ae3470965","Content-Type":"application/json"}};function I(e){return e.ok?e.json():Promise.reject("Ошибка: ".concat(e.status))}function P(e,t){t.textContent=e?"Сохранение...":"Cохранить"}function T(e,t){e.classList.add(t),e.disabled=!0}function D(e,t,n,r){var o=e.querySelector(n);!function(e){return e.some((function(e){return!e.validity.valid}))}(t)?function(e,t){e.classList.remove(t),e.disabled=!1}(o,r):T(o,r)}function N(e,t,n,r){var o,c=e.name,u=e.link,a=e.likes,i=e._id,l=e.owner,d=document.querySelector("#card").content.querySelector(".card").cloneNode(!0),s=d.querySelector(".card__img"),f=d.querySelector(".card__counter-like"),_=d.querySelector(".card__button-like"),m=d.querySelector(".card__button-delete");return s.src="".concat(u),s.alt="".concat(c),d.querySelector(".card__title").textContent="".concat(c),f.textContent=a.length.toString(),l._id==t&&m.classList.remove("card__button-delete_hidden"),Boolean(a.find((function(e){return e._id===t})))&&_.classList.add("card__button-like_active"),_.addEventListener("click",(function(){return n(f,_,i)})),m.addEventListener("click",(function(){return r(d,i)})),(o=d).querySelector(".card__img").addEventListener("click",(function(e){q.src="".concat(e.target.getAttribute("src")),k.textContent=o.querySelector(".card__title").textContent,q.alt=k.textContent,C(L)})),d}function J(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}function H(e,t,n){t.classList.contains("card__button-like_active")?function(e){return fetch("".concat(j.baseUrl,"/cards/likes/").concat(e),{method:"DELETE",headers:j.headers}).then((function(e){return I(e)}))}(n).then((function(n){e.textContent=n.likes.length,t.classList.toggle("card__button-like_active")})).catch((function(e){return console.log(e)})):function(e){return fetch("".concat(j.baseUrl,"/cards/likes/").concat(e),{method:"PUT",headers:j.headers}).then((function(e){return I(e)}))}(n).then((function(n){e.textContent=n.likes.length,t.classList.toggle("card__button-like_active")})).catch((function(e){return console.log(e)}))}function M(e,t){(function(e){return fetch("".concat(j.baseUrl,"/cards/").concat(e),{method:"DELETE",headers:j.headers}).then((function(e){return I(e)}))})(t).then((function(){e.remove()})).catch((function(e){return console.log(e)}))}w=(O=E).formSelector,U=function(e,t){if(null==e)return{};var n,r,o=function(e,t){if(null==e)return{};var n,r,o={},c=Object.keys(e);for(r=0;r<c.length;r++)n=c[r],t.indexOf(n)>=0||(o[n]=e[n]);return o}(e,t);if(Object.getOwnPropertySymbols){var c=Object.getOwnPropertySymbols(e);for(r=0;r<c.length;r++)n=c[r],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(o[n]=e[n])}return o}(O,["formSelector"]),Array.from(document.querySelectorAll(w)).forEach((function(e){e.addEventListener("submit",(function(e){e.preventDefault()})),function(e,t){var n=t.inputSelector,r=t.inputInvalidClass,o=t.buttonSelector,c=t.buttonDisabledClass,u=Array.from(e.querySelectorAll(n));u.forEach((function(t){t.addEventListener("input",(function(){!function(e,t,n){var r=e.querySelector("#error-".concat(t.id));t.validity.valid?function(e,t,n){e.classList.remove(t),n.textContent=""}(t,n,r):function(e,t,n,r){e.classList.add(t),n.textContent=r}(t,n,r,t.validationMessage)}(e,t,r),D(e,u,o,c)}))})),D(e,u,o,c)}(e,U)})),Promise.all([fetch("".concat(j.baseUrl,"/users/me"),{headers:j.headers}).then((function(e){return I(e)})),fetch("".concat(j.baseUrl,"/cards"),{headers:j.headers}).then((function(e){return I(e)}))]).then((function(e){var t,n,a=(n=2,function(e){if(Array.isArray(e))return e}(t=e)||function(e,t){var n=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=n){var r,o,c=[],u=!0,a=!1;try{for(n=n.call(e);!(u=(r=n.next()).done)&&(c.push(r.value),!t||c.length!==t);u=!0);}catch(e){a=!0,o=e}finally{try{u||null==n.return||n.return()}finally{if(a)throw o}}return c}}(t,n)||function(e,t){if(e){if("string"==typeof e)return J(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?J(e,t):void 0}}(t,n)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()),i=a[0];a[1].forEach((function(e){g.append(N(e,i._id,H,M))})),p.style.backgroundImage="url(".concat(i.avatar,")"),r.textContent=i.name,o.textContent=i.about,c.value=i.name,u.value=i.about})).catch((function(e){return console.log(e)})),e.addEventListener("click",(function(){return C(n)})),m.addEventListener("click",(function(){return C(y)})),i.addEventListener("click",(function(){return C(d)})),t.addEventListener("submit",(function(){return function(e,t,r,o){var c,u;P(!0,a),(c=e.value,u=t.value,fetch("".concat(j.baseUrl,"/users/me"),{method:"PATCH",headers:j.headers,body:JSON.stringify({name:c,about:u})}).then((function(e){return I(e)}))).then((function(e){r.textContent=e.name,o.textContent=e.about,x(n)})).catch((function(e){return console.log(e)})).finally((function(){P(!1,a)}))}(c,u,r,o)})),l.addEventListener("submit",(function(){var e,t;P(!0,_),(e=s.value,t=f.value,fetch("".concat(j.baseUrl,"/cards"),{method:"POST",headers:j.headers,body:JSON.stringify({name:e,link:t})}).then((function(e){return I(e)}))).then((function(e){g.prepend(N(e,e.owner._id,H,M)),s.value="",f.value="",x(d),T(_,E.buttonDisabledClass)})).catch((function(e){return console.log(e)})).finally((function(){P(!1,_)}))})),S.forEach((function(e){e.addEventListener("click",(function(t){t.target.classList.contains("popup_opened")&&x(e),t.target.classList.contains("popup__close")&&x(e)}))})),h.addEventListener("submit",(function(){var e;P(!0,b),(e=v.value,fetch("".concat(j.baseUrl,"/users/me/avatar"),{method:"PATCH",headers:j.headers,body:JSON.stringify({avatar:e})}).then((function(e){return I(e)}))).then((function(e){p.style.backgroundImage="url(".concat(e.avatar,")"),v.value="",T(b,E.buttonDisabledClass),x(y)})).catch((function(e){return console.log(e)})).finally((function(){P(!1,b)}))}))})();